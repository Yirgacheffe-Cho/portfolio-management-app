import { type TickerItem } from '@/types/stock';

/**
 * 특정 종목에 대한 전문가 수준의 심층 분석 리포트 생성을 요청하는 프롬프트 생성기 (간결화 버전)
 *
 * 이 프롬프트는 기존 정보 수집 프롬프트에서 얻은 데이터를 기반으로,
 * 투자 포인트, 재무 분석, 시장 데이터 분석, 리스크 분석, 목표 주가 제시 등을 포함하는
 * 구조화된 분석 리포트 작성을 간결하게 유도합니다.
 *
 * @param stockInfo - 종목 정보 (심볼, 국가, 회사명 포함)
 * @returns JSON 형태의 분석 리포트 요청 프롬프트 객체
 */
export function generateAnalysisReportPrompt(stockInfo: TickerItem): object {
  const { symbol, country, name } = stockInfo;

  return {
    request_type: '심층_주식_분석_리포트_작성',
    stock_info: {
      ticker: symbol,
      market_country: country,
      company_name: name || '',
    },
    analysis_requests: {
      overall_guidance: `
        제공된 ${name || '기업'} 주식 정보를 바탕으로 전문가 수준의 심층 분석 리포트를 작성해 주십시오.
        모든 주장은 제공된 정보에 근거하며, 객관적이고 중립적인 분석을 수행해야 합니다.
        일반 및 기관 투자자가 이해하기 쉽도록 명확하고 간결하게 작성하십시오.
      `,
      report_structure: [
        {
          heading: '🔍 투자 포인트 요약',
          description: '기업의 핵심 투자 매력을 3~5줄로 간결하게 요약.',
        },
        {
          heading: '🧾 기업 개요 및 최근 주요 뉴스 흐름',
          description:
            '기업 사업 영역 설명 및 최근 6개월간 주요 뉴스(공시/언론 기사) 핵심 요약. 기업 현황 및 주요 이슈 정리.',
        },
        {
          heading: '📊 재무제표 분석',
          description:
            '최근 2년 분기별 매출액, 영업이익, 순이익, 자산/부채/자본, 현금흐름 추이 분석 (YoY/QoQ 포함). 애널리스트 추정치와 실제 실적 차이, 향후 실적 전망 분석.',
        },
        {
          heading: '📝 애널리스트 리포트 분석 요약',
          description:
            '최근 6개월 내 주요 증권사 리포트(최대 5건) 핵심 요약. 투자 의견, 목표 주가, 주요 논점(긍정/부정), 이익 추정치 변화, 업황 분석 포함.',
        },
        {
          heading: '📈 시장 데이터 기반 기술적 분석 요약',
          description:
            '현재 주가, 거래량, 52주 최고/최저가, 시가총액, PER, PBR, 배당수익률, 베타 분석. 50/200일 이평선, RSI, MACD 등 주요 기술적 지표 수치 및 해석. 공매도 잔고, 기관/외국인 순매수/순매도 동향 분석.',
        },
        {
          heading: '📅 최근 실적 발표 및 IR 자료 핵심 내용',
          description:
            '최근 1년 실적 발표 컨퍼런스콜 및 IR 자료 핵심 요약. 경영진 사업 전망, 실적 분석, 주요 이슈 코멘트, 장기 전략, 신제품, 재무 목표, ESG 등 포함.',
        },
        {
          heading: '🌍 거시경제 및 지정학적 리스크 영향',
          description: `${name || '기업'} 산업 관련 거시경제 지표(금리, 인플레이션, GDP, 환율 등) 동향 및 지정학적 리스크(무역 분쟁, 공급망 규제 등)가 기업 사업/실적/주가에 미칠 잠재적 영향 심층 분석.`,
        },
        {
          heading: '🎯 목표 주가 제시 및 산정 근거',
          description: `
            제공된 모든 데이터 기반, AI가 종합적으로 판단하여 **자체적인 목표 주가** 제시:
            - 목표 주가 수치 (원 또는 달러)
            - 산정 방식 핵심 지표 (예: 예상 EPS, 적용 PER, 성장률 가정)
            - 동종 업계/과거 평균 대비 상대적 분석
            - 밸류에이션 방식 선택 이유 (예: PER, DCF, EV/EBITDA)
            - 애널리스트 목표 주가와 비교 및 차이 설명
            ⚠️ 주의: 애널리스트 목표 주가 단순 반복 금지. AI 스스로 해석 및 수치 도출.
          `.trim(),
        },
      ],
      response_format: 'Markdown',
      language: 'ko',
      tone: '전문적, 객관적, 중립적',
      reliability_guarantees: [
        '모든 분석은 제공된 출처 기반이며, 불분명하거나 미확인 정보는 배제합니다.',
        '분석은 원문의 핵심을 중립적이고 정확하게 반영하며, 주관적 해석/예측을 최소화합니다.',
        '추정치는 추정치임을 명확히 고지하고 출처/기준 시점을 명시합니다.',
        '정보가 부족하거나 없을 시, 해당 사실과 이유를 명확히 고지하고 가능한 범위 내에서 분석합니다.',
        '모든 수치 데이터는 정확한 단위와 기준 시점을 명시합니다.',
      ],
    },
  };
}
